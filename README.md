[![test](https://github.com/containernetworking/plugins/actions/workflows/test.yaml/badge.svg)](https://github.com/containernetworking/plugins/actions/workflows/test.yaml?query=branch%3Amaster)

# Plugins
Some CNI network plugins, maintained by the containernetworking team. For more information, see the [CNI website](https://www.cni.dev).

Read [CONTRIBUTING](CONTRIBUTING.md) for build and test instructions.

## Plugins supplied:
### Main: interface-creating
- âœ…loopback: å°†ç¯å›æ¥å£çš„çŠ¶æ€è®¾ç½®ä¸ºå¯åŠ¨ã€‚
- âœ…ptp: åˆ›å»ºä¸€ä¸ªvethå¯¹ã€‚
- âœ…dummy: åœ¨å®¹å™¨ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„è™šæ‹Ÿè®¾å¤‡ã€‚
- bridge: åˆ›å»ºä¸€ä¸ªç½‘æ¡¥ï¼Œå°†ä¸»æœºå’Œå®¹å™¨æ·»åŠ åˆ°å…¶ä¸­ã€‚
- ipvlan: åœ¨å®¹å™¨ä¸­æ·»åŠ ä¸€ä¸ª ipvlan æ¥å£ã€‚
- macvlan: åˆ›å»ºä¸€ä¸ªæ–°çš„MACåœ°å€ï¼Œå°†æ‰€æœ‰æµé‡è½¬å‘åˆ°è¯¥å®¹å™¨ã€‚
- vlan: åˆ†é…ä¸€ä¸ªvlanè®¾å¤‡ã€‚
- host-device: å°†å·²å­˜åœ¨çš„è®¾å¤‡ç§»åŠ¨åˆ°å®¹å™¨ä¸­ã€‚

### IPAM: IP address allocation
- âœ…host-local: ç»´æŠ¤ä¸€ä¸ªæœ¬åœ°å·²åˆ†é…IPçš„æ•°æ®åº“
- dhcp: åœ¨ä¸»æœºä¸Šè¿è¡Œå®ˆæŠ¤è¿›ç¨‹ï¼Œä»£è¡¨å®¹å™¨å‘å‡ºDHCPè¯·æ±‚
- static: ä¸ºå®¹å™¨åˆ†é…å•ä¸ªé™æ€IPv4/IPv6åœ°å€ã€‚å®ƒåœ¨è°ƒè¯•ç›®çš„ä¸­å¾ˆæœ‰ç”¨ã€‚

### Meta: other plugins
- âœ…portmap: ä¸€ä¸ªåŸºäºiptablesçš„ç«¯å£æ˜ å°„æ’ä»¶ã€‚å°†ä¸»æœºåœ°å€ç©ºé—´çš„ç«¯å£æ˜ å°„åˆ°å®¹å™¨ã€‚
- tuning: è°ƒæ•´ç°æœ‰æ¥å£çš„sysctlå‚æ•°
- bandwidth: é€šè¿‡ä½¿ç”¨æµé‡æ§åˆ¶tbfï¼ˆå…¥å£/å‡ºå£ï¼‰å…è®¸å¸¦å®½é™åˆ¶ã€‚
- sbr: ä¸€ä¸ªä¸ºæ¥å£é…ç½®æºåŸºäºè·¯ç”±çš„æ’ä»¶ï¼ˆä»å…¶é“¾æ¥ï¼‰ã€‚
- firewall: ä¸€ä¸ªä½¿ç”¨iptablesæˆ–firewalldæ·»åŠ è§„åˆ™ä»¥å…è®¸æ¥è‡ª/åˆ°å®¹å™¨çš„æµé‡çš„é˜²ç«å¢™æ’ä»¶ã€‚

### Sample
The sample plugin provides an example for building your own plugin.

## Contact

For any questions about CNI, please reach out via:
- Email: [cni-dev](https://groups.google.com/forum/#!forum/cni-dev)
- Slack: #cni on the [CNCF slack](https://slack.cncf.io/).

If you have a _security_ issue to report, please do so privately to the email addresses listed in the [OWNERS](OWNERS.md) file.

- https://www.jianshu.com/p/a1607e9eea32
- ip netns ls
- /var/run/netns/
- ip netns monitor


host-local åˆ†é…IP
loopback æ— ä¾èµ–
ptp ä¾èµ– host-local 
portmap ä¾èµ– ptp

bandwidth ä¾èµ– dummy




# iptables é‡ç½® 
```
cd /var/run/netns/
sudo iptables -F
sudo iptables -X
sudo iptables -t nat -F
sudo iptables -t nat -X
sudo iptables -t mangle -F
sudo iptables -t mangle -X
sudo iptables -P INPUT ACCEPT
sudo iptables -P FORWARD ACCEPT
sudo iptables -P OUTPUT ACCEPT
 
ls | xargs -I F umount F 
ls | xargs -I F rm -rf F 
```

# ptp
```
iptables -t nat -S
iptables -t nat -N CNI-1b29d9511ed2bb3134d925d5
# MASQUERADEï¼ˆæºåœ°å€ä¼ªè£…ï¼‰æˆ–è®¾ç½® MARKï¼ˆæ ‡è®°ï¼‰


âœ /Users/acejilam ğŸ¥ ssh root@vm
root@vm:~# iptables-save
# Generated by iptables-save v1.8.10 (nf_tables) on Mon Jul 15 14:27:51 2024
*filter
:INPUT ACCEPT [41379:5367738]
:FORWARD ACCEPT [12:735]
:OUTPUT ACCEPT [34363:8566873]
COMMIT
# Completed on Mon Jul 15 14:27:51 2024
# Generated by iptables-save v1.8.10 (nf_tables) on Mon Jul 15 14:27:51 2024
*nat
-A PREROUTING -m addrtype --dst-type LOCAL -j CNI-HOSTPORT-DNAT
-A OUTPUT -m addrtype --dst-type LOCAL -j CNI-HOSTPORT-DNAT

-A CNI-HOSTPORT-DNAT -p tcp -m comment --comment "dnat name: \"cni-portmap-unit-test\" id: \"unit-test-6822\"" -m multiport --dports 6822 -j CNI-DN-1a888857b95ed597c6b23

-A CNI-DN-1a888857b95ed597c6b23 -s 172.16.31.0/24 -p tcp -m tcp --dport 6822 -j CNI-HOSTPORT-SETMARK
-A CNI-DN-1a888857b95ed597c6b23 -s 127.0.0.1/32 -p tcp -m tcp --dport 6822 -j CNI-HOSTPORT-SETMARK
-A CNI-DN-1a888857b95ed597c6b23 -p tcp -m tcp --dport 6822 -j DNAT --to-destination 172.16.31.7:33771

-A CNI-HOSTPORT-SETMARK -m comment --comment "CNI portfwd masquerade mark" -j MARK --set-xmark 0x2000/0x2000 // è¯·æ±‚ 6822çš„éƒ½ä¼šè®¾ç½®mark


-A POSTROUTING -m comment --comment "CNI portfwd requiring masquerade" -j CNI-HOSTPORT-MASQ
-A CNI-HOSTPORT-MASQ -m mark --mark 0x2000/0x2000 -j MASQUERADE // å¸¦æœ‰0x2000æ ‡è®°çš„ï¼Œä¼ªè£…æºIP

-A POSTROUTING -s 172.16.31.7/32 -m comment --comment "name: \"cni-portmap-unit-test\" id: \"unit-test-6822\"" -j CNI-1a888857b95ed597c6b23d92
-A CNI-1a888857b95ed597c6b23d92 -d 172.16.31.0/24 -m comment --comment "name: \"cni-portmap-unit-test\" id: \"unit-test-6822\"" -j ACCEPT
-A CNI-1a888857b95ed597c6b23d92 ! -d 224.0.0.0/4 -m comment --comment "name: \"cni-portmap-unit-test\" id: \"unit-test-6822\"" -j MASQUERADE


COMMIT
# Completed on Mon Jul 15 14:27:51 2024
root@vm:~# ip route
default via 172.16.244.2 dev ens33 proto dhcp src 172.16.244.148 metric 100
172.16.31.7 dev vethdb5a994a scope host
172.16.244.0/24 dev ens33 proto kernel scope link src 172.16.244.148 metric 100
root@vm:~#

```







